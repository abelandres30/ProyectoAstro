---
import { Formatter } from "@utilsformatter";
import type { GetStaticPaths } from "astro";
import { Image } from "astro:assets";
import { getEntry } from "astro:content";
import { getCollection } from "astro:content";
import Layout from "src/layouts/Layout.astro";

export const getStaticPaths = ( async () => {

    const blogPosts = await getCollection('blog'); 

    return blogPosts.map((post) => ({
        params: { slug: post.slug },
        props: { post: post }
    }));
    
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const frontmatter = post.data;

const {Content, headings} = await post.render();
const author = ( await getEntry('author', post.data.author.id))!.data;

---

<Layout title={frontmatter.title}>
	<div>
        <a href="/blog" id="btn-back">
            <button  
                class="text-blue-500 cursor-pointer hover:text-blue-700 font-bold rounded focus:outline-none focus:shadow-outline">
                Regresar
            </button>
        </a>

        <h4 class="text-md text-gray-500 mb-0 text-left">{frontmatter.title}</h4>
        <!-- <h3 class="text-left text-gray-500 mb-0">{frontmatter.author}</h3> -->
        
        <div class="text-md text-gray-400 mb-0 flex flex-row mt-2">
            <Image
                src={author.avatar}
                alt={author.name}
                width={50}
                height={50}
                class="rounded-full"
            />

            <div class="flex flex-col ml-5">
                <a href={`/blog/posts/${frontmatter.author.id}`}>{author.name}</a>
                <span class="text-xs text-gray-200">
                    {Formatter.formatDate(frontmatter.date)}
                </span>
            </div>

        </div>

        <Image
            src={frontmatter.image}
            alt={frontmatter.title}
            width={600}
            height={220}
            class="object-cover w-full h-[250px] my-5 rounded-md" 
        />
        
        <!-- Tabla de contenidos -->
         <h3 class="text-left">Tabla de contenidos</h3>
         <ol class="text-left">
            {headings.map((heading, index) => (
                <li class="text-sm">
                    <a href={`#${heading.slug}`} class="text-blue-500 hover:text-blue-700">
                        {index + 1} - {heading.text}
                    </a>
                </li>
            ))}
         </ol>

        <!-- Contenido -->
        <Content/>

        <div class="my-20">
            <a href="#btn-back">Ir arriba</a>
        </div>
	</div>
</Layout>
